<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>PEIP: PEIP_XML_Context.php Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.1 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="namespaces.html"><span>Namespaces</span></a></li>
    <li><a href="classes.html"><span>Classes</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
  </ul></div>
<h1>PEIP_XML_Context.php</h1><a href="PEIP__XML__Context_8php.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00002"></a>00002 
<a name="l00003"></a>00003 <span class="comment">/*</span>
<a name="l00004"></a>00004 <span class="comment"> * This file is part of the PEIP package.</span>
<a name="l00005"></a>00005 <span class="comment"> * (c) 2010 Timo Michna &lt;timomichna/yahoo.de&gt;</span>
<a name="l00006"></a>00006 <span class="comment"> * </span>
<a name="l00007"></a>00007 <span class="comment"> * For the full copyright and license information, please view the LICENSE</span>
<a name="l00008"></a>00008 <span class="comment"> * file that was distributed with this source code.</span>
<a name="l00009"></a>00009 <span class="comment"> */</span>
<a name="l00010"></a>00010 
<a name="l00021"></a><a class="code" href="classPEIP__XML__Context.html">00021</a> <span class="keyword">class </span><a class="code" href="classPEIP__XML__Context.html">PEIP_XML_Context</a> 
<a name="l00022"></a>00022     <span class="keyword">implements</span> 
<a name="l00023"></a>00023         <a class="code" href="interfacePEIP__INF__Context.html">PEIP_INF_Context</a>,
<a name="l00024"></a>00024         <a class="code" href="interfacePEIP__INF__Channel__Resolver.html">PEIP_INF_Channel_Resolver</a> {
<a name="l00025"></a>00025 
<a name="l00026"></a>00026     <span class="keyword">protected</span> 
<a name="l00027"></a><a class="code" href="classPEIP__XML__Context.html#edb776201f8905a675d5ebae7f0f32ab">00027</a>         <a class="code" href="classPEIP__XML__Context.html#edb776201f8905a675d5ebae7f0f32ab">$services</a> = array(),
<a name="l00028"></a><a class="code" href="classPEIP__XML__Context.html#5231afd7b5a5221607cb1aee9ccb09f5">00028</a>         <a class="code" href="classPEIP__XML__Context.html#5231afd7b5a5221607cb1aee9ccb09f5">$configs</a> = array(),
<a name="l00029"></a><a class="code" href="classPEIP__XML__Context.html#dd669e3dc92d78e06da762a344f8e5b2">00029</a>         <a class="code" href="classPEIP__XML__Context.html#dd669e3dc92d78e06da762a344f8e5b2">$gateways</a> = array(),
<a name="l00030"></a><a class="code" href="classPEIP__XML__Context.html#4f74c26c7dd28110017a62a6793d7720">00030</a>         <a class="code" href="classPEIP__XML__Context.html#4f74c26c7dd28110017a62a6793d7720">$nodeBuilders</a> = array(),
<a name="l00031"></a>00031         <a class="code" href="classPEIP__XML__Context.html#54bb3000e2d7e279c14667352627f94e">$channelRegistry</a>;
<a name="l00032"></a>00032     
<a name="l00033"></a>00033     
<a name="l00034"></a>00034     
<a name="l00035"></a>00035     
<a name="l00041"></a><a class="code" href="classPEIP__XML__Context.html#59f82260955506a9f9455a532e7ba4fe">00041</a>     <span class="keyword">public</span> function <a class="code" href="classPEIP__XML__Context.html#59f82260955506a9f9455a532e7ba4fe">__construct</a>($xml){
<a name="l00042"></a>00042         $this-&gt;simpleXML = <span class="keyword">new</span> SimpleXMLIterator($xml);
<a name="l00043"></a>00043         $this-&gt;initNodeBuilders();
<a name="l00044"></a>00044         $this-&gt;<a class="code" href="classPEIP__XML__Context.html#a0961e84d19523f8e51f54f25ecd30af">init</a>();
<a name="l00045"></a>00045     }
<a name="l00046"></a>00046 
<a name="l00047"></a><a class="code" href="classPEIP__XML__Context.html#ab465cb9c82bd43eeb855fb5d39f3181">00047</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="classPEIP__XML__Context.html#ab465cb9c82bd43eeb855fb5d39f3181">createFromString</a>($xml){
<a name="l00048"></a>00048         <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classPEIP__XML__Context.html">PEIP_XML_Context</a>($xml);
<a name="l00049"></a>00049     }
<a name="l00050"></a>00050     
<a name="l00051"></a><a class="code" href="classPEIP__XML__Context.html#5f4b57fa44b5f810966e3db75329906a">00051</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="classPEIP__XML__Context.html#5f4b57fa44b5f810966e3db75329906a">createFromFile</a>($file){
<a name="l00052"></a>00052         <span class="keywordflow">if</span>(file_exists($file)){
<a name="l00053"></a>00053             <span class="keywordflow">return</span> self::createFromString(file_get_contents($file));
<a name="l00054"></a>00054         }<span class="keywordflow">else</span>{
<a name="l00055"></a>00055             <span class="keywordflow">throw</span> <span class="keyword">new</span> RuntimeException('Cannot open file  <span class="stringliteral">"'.$file.'"</span>.');
<a name="l00056"></a>00056         }
<a name="l00057"></a>00057     }
<a name="l00058"></a>00058 
<a name="l00059"></a>00059     
<a name="l00066"></a><a class="code" href="classPEIP__XML__Context.html#cbcb16ffd046d7519f5c22bc1348b491">00066</a>     <span class="keyword">public</span> function <a class="code" href="classPEIP__XML__Context.html#cbcb16ffd046d7519f5c22bc1348b491">registerNodeBuilder</a>($nodeName, $callable){
<a name="l00067"></a>00067         $this-&gt;nodeBuilders[$nodeName] = $callable;     
<a name="l00068"></a>00068     }
<a name="l00069"></a>00069 
<a name="l00070"></a>00070     
<a name="l00076"></a><a class="code" href="classPEIP__XML__Context.html#150180dd8bd8abac03260b1c69d472ae">00076</a>     <span class="keyword">public</span> function <a class="code" href="classPEIP__XML__Context.html#150180dd8bd8abac03260b1c69d472ae">addPlugin</a>(<a class="code" href="interfacePEIP__INF__Context__Plugin.html">PEIP_INF_Context_Plugin</a> $plugin){
<a name="l00077"></a>00077         $plugin-&gt;<a class="code" href="interfacePEIP__INF__Context__Plugin.html#88c701c3219e5bcdb65b57c850b0bc8a">init</a>($this);   
<a name="l00078"></a>00078     }
<a name="l00079"></a>00079 
<a name="l00080"></a>00080     
<a name="l00086"></a><a class="code" href="classPEIP__XML__Context.html#c37488e87490870979e88002e99c3173">00086</a>     <span class="keyword">public</span> function <a class="code" href="classPEIP__XML__Context.html#c37488e87490870979e88002e99c3173">createPlugin</a>($config){
<a name="l00087"></a>00087         $plugin = $this-&gt;<a class="code" href="classPEIP__XML__Context.html#041baeaf4181c36a38c1510186163630">createService</a>($config);    
<a name="l00088"></a>00088         $this-&gt;<a class="code" href="classPEIP__XML__Context.html#150180dd8bd8abac03260b1c69d472ae">addPlugin</a>($plugin);
<a name="l00089"></a>00089     }
<a name="l00090"></a>00090     
<a name="l00091"></a>00091     
<a name="l00092"></a>00092     <span class="keyword">private</span> function initNodeBuilders(){
<a name="l00093"></a>00093         $builders = array(
<a name="l00094"></a>00094             'plugin' =&gt; '<a class="code" href="classPEIP__XML__Context.html#c37488e87490870979e88002e99c3173">createPlugin</a>',
<a name="l00095"></a>00095             'channel' =&gt; '<a class="code" href="classPEIP__XML__Context.html#17515f53b695710d407a8861ff767928">createChannel</a>',
<a name="l00096"></a>00096             'publish_subscribe_channel' =&gt; '<a class="code" href="classPEIP__XML__Context.html#2090534b5e17f88a01894b968e563f4f">createSubscribebalChannel</a>',
<a name="l00097"></a>00097             'service' =&gt; '<a class="code" href="classPEIP__XML__Context.html#a6029cf1428b8760a4dd5a0df12b3c92">initService</a>',
<a name="l00098"></a>00098             'service_activator' =&gt; '<a class="code" href="classPEIP__XML__Context.html#bc8de4ef87cc9a3817466ffaef6997af">createServiceActivator</a>',
<a name="l00099"></a>00099             'gateway' =&gt; '<a class="code" href="classPEIP__XML__Context.html#b7b5bf3c31a08ab80b2f7c36cb516770">createGateway</a>',
<a name="l00100"></a>00100             'splitter' =&gt; '<a class="code" href="classPEIP__XML__Context.html#16da23b8fb8c6b11531e1ad553a2eb78">createSplitter</a>',
<a name="l00101"></a>00101             'router' =&gt; '<a class="code" href="classPEIP__XML__Context.html#4702a7cedde8b448bbd7b818c8fc1622">createRouter</a>',
<a name="l00102"></a>00102             'aggregator' =&gt; '<a class="code" href="classPEIP__XML__Context.html#8591aad3b361d6e7a2f4a6fc3bff6e3c">createAggregator</a>',
<a name="l00103"></a>00103             'wiretap' =&gt; '<a class="code" href="classPEIP__XML__Context.html#6485dedb3f05f4bcb2c9dffb0c284866">createWiretap</a>'
<a name="l00104"></a>00104                 
<a name="l00105"></a>00105         );
<a name="l00106"></a>00106         foreach($builders as $nodeName =&gt; $method){
<a name="l00107"></a>00107             $this-&gt;<a class="code" href="classPEIP__XML__Context.html#cbcb16ffd046d7519f5c22bc1348b491">registerNodeBuilder</a>($nodeName, array($this, $method));   
<a name="l00108"></a>00108         }       
<a name="l00109"></a>00109     }
<a name="l00110"></a>00110 
<a name="l00111"></a>00111     
<a name="l00125"></a><a class="code" href="classPEIP__XML__Context.html#e3c67d3ce349a904f68bc7d6a3331e3e">00125</a>     <span class="keyword">protected</span> function <a class="code" href="classPEIP__XML__Context.html#e3c67d3ce349a904f68bc7d6a3331e3e">buildNode</a>($node){
<a name="l00126"></a>00126         $nodeName = $node-&gt;getName();
<a name="l00127"></a>00127         <span class="keywordflow">if</span>(array_key_exists($nodeName, $this-&gt;nodeBuilders)){
<a name="l00128"></a>00128             call_user_func($this-&gt;nodeBuilders[$nodeName], $node);
<a name="l00129"></a>00129         }           
<a name="l00130"></a>00130     }
<a name="l00131"></a>00131     
<a name="l00132"></a>00132     
<a name="l00137"></a><a class="code" href="classPEIP__XML__Context.html#a0961e84d19523f8e51f54f25ecd30af">00137</a>     <span class="keyword">protected</span> function <a class="code" href="classPEIP__XML__Context.html#a0961e84d19523f8e51f54f25ecd30af">init</a>(){
<a name="l00138"></a>00138         $xml = $this-&gt;simpleXML;
<a name="l00139"></a>00139         $this-&gt;channelRegistry = <a class="code" href="classPEIP__Channel__Registry.html#ae70c23c49e7f0348accc651d4c2d2bc">PEIP_Channel_Registry::getInstance</a>();
<a name="l00140"></a>00140         <span class="keywordflow">if</span>($xml['<span class="keywordtype">id</span>']){
<a name="l00141"></a>00141             $this-&gt;services[(string)$xml['<span class="keywordtype">id</span>']] = $this;    
<a name="l00142"></a>00142         }
<a name="l00143"></a>00143         foreach($xml-&gt;children() as $entry){
<a name="l00144"></a>00144             $this-&gt;<a class="code" href="classPEIP__XML__Context.html#e3c67d3ce349a904f68bc7d6a3331e3e">buildNode</a>($entry);
<a name="l00145"></a>00145         }
<a name="l00146"></a>00146     }
<a name="l00147"></a>00147 
<a name="l00148"></a>00148     
<a name="l00154"></a><a class="code" href="classPEIP__XML__Context.html#56a1a5d96372da3023d1d0461031222f">00154</a>     <span class="keyword">public</span> function <a class="code" href="classPEIP__XML__Context.html#56a1a5d96372da3023d1d0461031222f">resolveChannelName</a>($channelName){
<a name="l00155"></a>00155         <span class="keywordflow">return</span> $this-&gt;channelRegistry-&gt;get($channelName);
<a name="l00156"></a>00156     }   
<a name="l00157"></a>00157     
<a name="l00158"></a>00158     
<a name="l00164"></a><a class="code" href="classPEIP__XML__Context.html#960a3916e12b0a31da207e81419e1ba1">00164</a>     <span class="keyword">public</span> function <a class="code" href="classPEIP__XML__Context.html#960a3916e12b0a31da207e81419e1ba1">getService</a>($id){    
<a name="l00165"></a>00165         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classPEIP__XML__Context.html#3ca9fba70439ca659b2bf5f0187699dd">hasService</a>($id)  
<a name="l00166"></a>00166             ? $this-&gt;services[$id]
<a name="l00167"></a>00167             : NULL;
<a name="l00168"></a>00168     }
<a name="l00169"></a>00169 
<a name="l00170"></a>00170     
<a name="l00176"></a><a class="code" href="classPEIP__XML__Context.html#3ca9fba70439ca659b2bf5f0187699dd">00176</a>     <span class="keyword">public</span> function <a class="code" href="classPEIP__XML__Context.html#3ca9fba70439ca659b2bf5f0187699dd">hasService</a>($id){
<a name="l00177"></a>00177         <span class="keywordflow">return</span> isset($this-&gt;services[$id]);
<a name="l00178"></a>00178     }
<a name="l00179"></a>00179     
<a name="l00180"></a>00180     
<a name="l00186"></a><a class="code" href="classPEIP__XML__Context.html#42a7db6a5200a2727ced0894afd7341d">00186</a>     <span class="keyword">protected</span> function <a class="code" href="classPEIP__XML__Context.html#42a7db6a5200a2727ced0894afd7341d">requestService</a>($id){
<a name="l00187"></a>00187         $service = $this-&gt;<a class="code" href="classPEIP__XML__Context.html#960a3916e12b0a31da207e81419e1ba1">getService</a>($id);
<a name="l00188"></a>00188         <span class="keywordflow">if</span>($service === NULL){
<a name="l00189"></a>00189             <span class="keywordflow">throw</span> <span class="keyword">new</span> RuntimeException('Service <span class="stringliteral">"'.$id.'"</span> not found.');
<a name="l00190"></a>00190         } 
<a name="l00191"></a>00191         <span class="keywordflow">return</span> $service;
<a name="l00192"></a>00192     }
<a name="l00193"></a>00193     
<a name="l00194"></a>00194     
<a name="l00205"></a><a class="code" href="classPEIP__XML__Context.html#a6029cf1428b8760a4dd5a0df12b3c92">00205</a>     <span class="keyword">protected</span> function <a class="code" href="classPEIP__XML__Context.html#a6029cf1428b8760a4dd5a0df12b3c92">initService</a>($config){
<a name="l00206"></a>00206         $id = trim((string)$config['<span class="keywordtype">id</span>']);
<a name="l00207"></a>00207         <span class="keywordflow">if</span>($id != ''){
<a name="l00208"></a>00208             <span class="keywordflow">return</span> $this-&gt;services[$id] = $this-&gt;<a class="code" href="classPEIP__XML__Context.html#041baeaf4181c36a38c1510186163630">createService</a>($config);    
<a name="l00209"></a>00209         }   
<a name="l00210"></a>00210     }
<a name="l00211"></a>00211 
<a name="l00212"></a>00212                 
<a name="l00213"></a>00213     
<a name="l00219"></a><a class="code" href="classPEIP__XML__Context.html#041baeaf4181c36a38c1510186163630">00219</a>     <span class="keyword">public</span> function <a class="code" href="classPEIP__XML__Context.html#041baeaf4181c36a38c1510186163630">createService</a>($config){
<a name="l00220"></a>00220         $args = array();
<a name="l00221"></a>00221         <span class="keywordflow">if</span>($config-&gt;constructor_arg){
<a name="l00222"></a>00222             foreach($config-&gt;constructor_arg as $arg){
<a name="l00223"></a>00223                 $args[] = $this-&gt;<a class="code" href="classPEIP__XML__Context.html#18d34b20f72990e09a02f33768c6f642">buildArg</a>($arg);
<a name="l00224"></a>00224             }
<a name="l00225"></a>00225         }
<a name="l00226"></a>00226         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classPEIP__XML__Context.html#67659c378217309ceaa0a53b83bd19cc">buildAndModify</a>($config, $args);       
<a name="l00227"></a>00227     }
<a name="l00228"></a>00228 
<a name="l00229"></a>00229     
<a name="l00236"></a><a class="code" href="classPEIP__XML__Context.html#0be6ac0ca978b1900335c330789d7196">00236</a>     <span class="keyword">protected</span> function <a class="code" href="classPEIP__XML__Context.html#0be6ac0ca978b1900335c330789d7196">modifyService</a>($service, $config){
<a name="l00237"></a>00237         <span class="keywordflow">if</span>($config-&gt;property){          
<a name="l00238"></a>00238             foreach($config-&gt;property as $property){
<a name="l00239"></a>00239                 $setter = self::getSetter($property);
<a name="l00240"></a>00240                 <span class="keywordflow">if</span>($setter){                
<a name="l00241"></a>00241                     $arg = $this-&gt;<a class="code" href="classPEIP__XML__Context.html#18d34b20f72990e09a02f33768c6f642">buildArg</a>($property);
<a name="l00242"></a>00242                     <span class="keywordflow">if</span>($arg){
<a name="l00243"></a>00243                         $service-&gt;{$setter}($arg);  
<a name="l00244"></a>00244                     }
<a name="l00245"></a>00245                 }
<a name="l00246"></a>00246             }
<a name="l00247"></a>00247         }   
<a name="l00248"></a>00248         <span class="keywordflow">if</span>($config-&gt;action){            
<a name="l00249"></a>00249             foreach($config-&gt;action as $action){
<a name="l00250"></a>00250                 <span class="keywordflow">if</span>($action['method'] &amp;&amp; method_exists($service, (string)$action['method'])){
<a name="l00251"></a>00251                     $args = array();
<a name="l00252"></a>00252                     foreach($action-&gt;children() as $argument){
<a name="l00253"></a>00253                         $args[] = $this-&gt;<a class="code" href="classPEIP__XML__Context.html#18d34b20f72990e09a02f33768c6f642">buildArg</a>($argument);
<a name="l00254"></a>00254                     }
<a name="l00255"></a>00255                     call_user_func_array(array($service, (string)$action['method']), $args);
<a name="l00256"></a>00256                 }
<a name="l00257"></a>00257             }
<a name="l00258"></a>00258         }       
<a name="l00259"></a>00259         <span class="keywordflow">if</span>($service instanceof <a class="code" href="interfacePEIP__INF__Connectable.html">PEIP_INF_Connectable</a>){
<a name="l00260"></a>00260             <span class="keywordflow">if</span>($config-&gt;listener){
<a name="l00261"></a>00261                 foreach($config-&gt;listener as $listenerConf){
<a name="l00262"></a>00262                     $event = (string)$listenerConf['event'];
<a name="l00263"></a>00263                     $listener = $this-&gt;<a class="code" href="classPEIP__XML__Context.html#cbc989e08e42530223dc9d97cbf21ce8">provideService</a>($config);  
<a name="l00264"></a>00264                     $service-&gt;connect($event, $listener);   
<a name="l00265"></a>00265                 }
<a name="l00266"></a>00266             }
<a name="l00267"></a>00267         }
<a name="l00268"></a>00268         <span class="keywordflow">return</span> $service;
<a name="l00269"></a>00269     }   
<a name="l00270"></a>00270     
<a name="l00271"></a>00271     
<a name="l00277"></a><a class="code" href="classPEIP__XML__Context.html#148524b9515b1faf9d3e1ad5f5103077">00277</a>     <span class="keyword">public</span> function getGateway($id){
<a name="l00278"></a>00278         <span class="keywordflow">return</span> $this-&gt;gateways[$id];
<a name="l00279"></a>00279     }   
<a name="l00280"></a>00280 
<a name="l00281"></a>00281     
<a name="l00287"></a><a class="code" href="classPEIP__XML__Context.html#17515f53b695710d407a8861ff767928">00287</a>     <span class="keyword">public</span> function createChannel($config){
<a name="l00288"></a>00288         <span class="keywordflow">return</span> $this-&gt;doCreateChannel($config, '<a class="code" href="classPEIP__Pollable__Channel.html">PEIP_Pollable_Channel</a>');        
<a name="l00289"></a>00289     }
<a name="l00290"></a>00290 
<a name="l00291"></a>00291     
<a name="l00297"></a><a class="code" href="classPEIP__XML__Context.html#2090534b5e17f88a01894b968e563f4f">00297</a>     <span class="keyword">public</span> function createSubscribebalChannel($config){
<a name="l00298"></a>00298         <span class="keywordflow">return</span> $this-&gt;doCreateChannel($config, '<a class="code" href="classPEIP__Publish__Subscribe__Channel.html">PEIP_Publish_Subscribe_Channel</a>');       
<a name="l00299"></a>00299     }   
<a name="l00300"></a>00300 
<a name="l00301"></a>00301     
<a name="l00309"></a><a class="code" href="classPEIP__XML__Context.html#583e8e77803cdbf28e41d071a708af31">00309</a>     <span class="keyword">public</span> function doCreateChannel($config, $defaultChannel, array $additionalArguments = array()){
<a name="l00310"></a>00310         $id = (string)$config['<span class="keywordtype">id</span>'];
<a name="l00311"></a>00311         <span class="keywordflow">if</span>($id != ''){
<a name="l00312"></a>00312             array_unshift($additionalArguments, $id);
<a name="l00313"></a>00313             $channel = $this-&gt;buildAndModify($config, array($id), $defaultChannel);
<a name="l00314"></a>00314             $this-&gt;channelRegistry-&gt;register($channel);
<a name="l00315"></a>00315             <span class="keywordflow">return</span> $channel;
<a name="l00316"></a>00316         }
<a name="l00317"></a>00317     }
<a name="l00318"></a>00318     
<a name="l00319"></a>00319     
<a name="l00320"></a>00320     
<a name="l00327"></a><a class="code" href="classPEIP__XML__Context.html#b7b5bf3c31a08ab80b2f7c36cb516770">00327</a>     <span class="keyword">public</span> function createGateway($config, $defaultClass = <span class="keyword">false</span>){
<a name="l00328"></a>00328         $args = array(
<a name="l00329"></a>00329             $this-&gt;getRequestChannel($config), 
<a name="l00330"></a>00330             $this-&gt;getReplyChannel($config)
<a name="l00331"></a>00331         );
<a name="l00332"></a>00332         $defaultClass = $defaultClass ? $defaultClass : '<a class="code" href="classPEIP__Simple__Messaging__Gateway.html">PEIP_Simple_Messaging_Gateway</a>';
<a name="l00333"></a>00333         $gateway = $this-&gt;buildAndModify($config, $args, $defaultClass);
<a name="l00334"></a>00334         $id = (string)$config[<span class="stringliteral">"id"</span>];
<a name="l00335"></a>00335         $this-&gt;gateways[$id] = $gateway;
<a name="l00336"></a>00336         <span class="keywordflow">return</span> $gateway;    
<a name="l00337"></a>00337     }
<a name="l00338"></a>00338 
<a name="l00339"></a>00339     
<a name="l00345"></a><a class="code" href="classPEIP__XML__Context.html#4702a7cedde8b448bbd7b818c8fc1622">00345</a>     <span class="keyword">public</span> function createRouter($config){
<a name="l00346"></a>00346         $resolver = $config['channel_resolver'] ? (string)$config['channel_resolver'] : $this-&gt;channelRegistry;
<a name="l00347"></a>00347         <span class="keywordflow">return</span> $this-&gt;buildAndModify($config, array(
<a name="l00348"></a>00348             $resolver,
<a name="l00349"></a>00349             $this-&gt;doGetChannel('input', $config)
<a name="l00350"></a>00350         ));
<a name="l00351"></a>00351     }
<a name="l00352"></a>00352     
<a name="l00353"></a>00353     
<a name="l00359"></a><a class="code" href="classPEIP__XML__Context.html#16da23b8fb8c6b11531e1ad553a2eb78">00359</a>     <span class="keyword">public</span> function createSplitter($config){
<a name="l00360"></a>00360         <span class="keywordflow">return</span> $this-&gt;createReplyMessageHandler($config);           
<a name="l00361"></a>00361     }   
<a name="l00362"></a>00362     
<a name="l00363"></a>00363     
<a name="l00369"></a><a class="code" href="classPEIP__XML__Context.html#8591aad3b361d6e7a2f4a6fc3bff6e3c">00369</a>     <span class="keyword">public</span> function createAggregator($config){
<a name="l00370"></a>00370         <span class="keywordflow">return</span> $this-&gt;createReplyMessageHandler($config);       
<a name="l00371"></a>00371     }
<a name="l00372"></a>00372 
<a name="l00373"></a>00373     
<a name="l00379"></a><a class="code" href="classPEIP__XML__Context.html#6485dedb3f05f4bcb2c9dffb0c284866">00379</a>     <span class="keyword">public</span> function createWiretap($config){
<a name="l00380"></a>00380         <span class="keywordflow">return</span> $this-&gt;createReplyMessageHandler($config, '<a class="code" href="classPEIP__Wiretap.html">PEIP_Wiretap</a>');       
<a name="l00381"></a>00381     }
<a name="l00382"></a>00382 
<a name="l00383"></a>00383     
<a name="l00390"></a><a class="code" href="classPEIP__XML__Context.html#43f578ca8ce07f5b1f4fae703e330896">00390</a>     <span class="keyword">public</span> function createReplyMessageHandler($config, $defaultClass = <span class="keyword">false</span>){
<a name="l00391"></a>00391         <span class="keywordflow">return</span> $this-&gt;buildAndModify($config, $this-&gt;getReplyHandlerArguments($config), $defaultClass); 
<a name="l00392"></a>00392     }
<a name="l00393"></a>00393     
<a name="l00394"></a>00394     
<a name="l00395"></a>00395     
<a name="l00408"></a><a class="code" href="classPEIP__XML__Context.html#bc8de4ef87cc9a3817466ffaef6997af">00408</a>     <span class="keyword">public</span> function createServiceActivator($config, $defaultClass = <span class="keyword">false</span>){
<a name="l00409"></a>00409         $method = (string)$config['method'];
<a name="l00410"></a>00410         $service = $this-&gt;getService((string)$config['ref']);
<a name="l00411"></a>00411         <span class="keywordflow">if</span>($method &amp;&amp; $service){        
<a name="l00412"></a>00412             $args = $this-&gt;getReplyHandlerArguments($config);
<a name="l00413"></a>00413             array_unshift($args,array(
<a name="l00414"></a>00414                 $service,
<a name="l00415"></a>00415                 $method             
<a name="l00416"></a>00416             )); 
<a name="l00417"></a>00417             echo $defaultClass = $defaultClass ? $defaultClass : '<a class="code" href="classPEIP__Service__Activator.html">PEIP_Service_Activator</a>';
<a name="l00418"></a>00418             <span class="keywordflow">return</span> $this-&gt;buildAndModify($config, $args, $defaultClass);                
<a name="l00419"></a>00419         }
<a name="l00420"></a>00420     }   
<a name="l00421"></a>00421     
<a name="l00422"></a>00422     
<a name="l00428"></a><a class="code" href="classPEIP__XML__Context.html#cbc989e08e42530223dc9d97cbf21ce8">00428</a>     <span class="keyword">protected</span> function provideService($config){
<a name="l00429"></a>00429         $ref = trim((string)$config['ref']);
<a name="l00430"></a>00430         <span class="keywordflow">if</span>($ref != ''){
<a name="l00431"></a>00431             $service = $this-&gt;getService($ref); 
<a name="l00432"></a>00432         }<span class="keywordflow">else</span>{
<a name="l00433"></a>00433             $service = $this-&gt;createService($config);
<a name="l00434"></a>00434         }
<a name="l00435"></a>00435         <span class="keywordflow">return</span> $service;
<a name="l00436"></a>00436     }
<a name="l00437"></a>00437        
<a name="l00438"></a><a class="code" href="classPEIP__XML__Context.html#9fcf1978dac68a00da9285885ffe819f">00438</a>     <span class="keyword">protected</span> <span class="keyword">static</span> function getSetter($config){
<a name="l00439"></a>00439         <span class="keywordflow">if</span>($config['setter']){
<a name="l00440"></a>00440             $setter = (string)$config['setter'];
<a name="l00441"></a>00441         }elseif($config['name']){
<a name="l00442"></a>00442             $setter = 'set'.ucfirst((string)$config['name']);   
<a name="l00443"></a>00443         }
<a name="l00444"></a>00444         <span class="keywordflow">return</span> $setter;     
<a name="l00445"></a>00445     }
<a name="l00446"></a>00446     
<a name="l00447"></a>00447     
<a name="l00448"></a>00448        
<a name="l00449"></a>00449     
<a name="l00463"></a><a class="code" href="classPEIP__XML__Context.html#18d34b20f72990e09a02f33768c6f642">00463</a>     <span class="keyword">protected</span> function buildArg($config){
<a name="l00464"></a>00464         <span class="keywordflow">if</span>(trim((string)$config['value']) != ''){
<a name="l00465"></a>00465             $arg = (string)$config['value'];
<a name="l00466"></a>00466         }elseif($config-&gt;getName() == 'value'){
<a name="l00467"></a>00467             $arg = (string)$config;
<a name="l00468"></a>00468         }elseif($config-&gt;getName() == 'list'){
<a name="l00469"></a>00469             $arg = array();
<a name="l00470"></a>00470             foreach($config-&gt;children() as $entry){ 
<a name="l00471"></a>00471                 <span class="keywordflow">if</span>($entry-&gt;getName() == 'value'){
<a name="l00472"></a>00472                     <span class="keywordflow">if</span>($entry['key']){
<a name="l00473"></a>00473                         $arg[(string)$entry['key']] = (string)$entry;   
<a name="l00474"></a>00474                     }<span class="keywordflow">else</span>{
<a name="l00475"></a>00475                         $arg[] = (string)$entry;
<a name="l00476"></a>00476                     }
<a name="l00477"></a>00477                 }elseif($entry-&gt;getName() == 'service'){
<a name="l00478"></a>00478                     $arg[] = $this-&gt;provideService($entry);
<a name="l00479"></a>00479                 }
<a name="l00480"></a>00480             }
<a name="l00481"></a>00481         }elseif($config-&gt;getName() == 'service'){
<a name="l00482"></a>00482             $arg = $this-&gt;provideService($config);
<a name="l00483"></a>00483         }elseif($config-&gt;list){
<a name="l00484"></a>00484             $arg = $this-&gt;buildArg($config-&gt;list);
<a name="l00485"></a>00485         }elseif($config-&gt;service){
<a name="l00486"></a>00486             $arg = $this-&gt;buildArg($config-&gt;service);
<a name="l00487"></a>00487         }
<a name="l00488"></a>00488         <span class="keywordflow">return</span> $arg;
<a name="l00489"></a>00489     }       
<a name="l00490"></a>00490 
<a name="l00491"></a>00491     
<a name="l00497"></a><a class="code" href="classPEIP__XML__Context.html#cafc90d5bc67085fd8d71594412fa57e">00497</a>     <span class="keyword">protected</span> function getReplyHandlerArguments($config){
<a name="l00498"></a>00498         $args = array(
<a name="l00499"></a>00499             $this-&gt;doGetChannel('input', $config),
<a name="l00500"></a>00500             $this-&gt;doGetChannel('output', $config)
<a name="l00501"></a>00501         );
<a name="l00502"></a>00502         <span class="keywordflow">if</span>($args[0] == NULL){
<a name="l00503"></a>00503             <span class="keywordflow">throw</span> <span class="keyword">new</span> RuntimeException('Could not receive input channel.');
<a name="l00504"></a>00504         }
<a name="l00505"></a>00505         <span class="keywordflow">return</span> $args;
<a name="l00506"></a>00506     }
<a name="l00507"></a>00507     
<a name="l00508"></a>00508     
<a name="l00514"></a><a class="code" href="classPEIP__XML__Context.html#18e4ffbd90214980c13c7ddbbcfd76c2">00514</a>     <span class="keyword">protected</span> function getRequestChannel($config){
<a name="l00515"></a>00515         <span class="keywordflow">return</span> $this-&gt;doGetChannel('request', $config); 
<a name="l00516"></a>00516     }
<a name="l00517"></a>00517     
<a name="l00518"></a>00518     
<a name="l00524"></a><a class="code" href="classPEIP__XML__Context.html#5587585807806c828132ae510586d702">00524</a>     <span class="keyword">protected</span> function getReplyChannel($config){
<a name="l00525"></a>00525         <span class="keywordflow">return</span> $this-&gt;doGetChannel('reply', $config);   
<a name="l00526"></a>00526     }
<a name="l00527"></a>00527     
<a name="l00528"></a>00528     
<a name="l00535"></a><a class="code" href="classPEIP__XML__Context.html#a8d667ce49af2d7068e77c73eab5f718">00535</a>     <span class="keyword">public</span> function doGetChannel($type, $config){
<a name="l00536"></a>00536         $channelName = $config[$type.<span class="stringliteral">"_channel"</span>] 
<a name="l00537"></a>00537             ? $config[$type.<span class="stringliteral">"_channel"</span>] 
<a name="l00538"></a>00538             : $config[<span class="stringliteral">"default_"</span>.$type.<span class="stringliteral">"_channel"</span>]; 
<a name="l00539"></a>00539         $channel =  $this-&gt;services[trim((string)$channelName)];
<a name="l00540"></a>00540         <span class="keywordflow">if</span>($channel instanceof <a class="code" href="interfacePEIP__INF__Channel.html">PEIP_INF_Channel</a>){
<a name="l00541"></a>00541             <span class="keywordflow">return</span> $channel;    
<a name="l00542"></a>00542         }<span class="keywordflow">else</span>{
<a name="l00543"></a>00543             <span class="keywordflow">return</span> NULL;
<a name="l00544"></a>00544         }       
<a name="l00545"></a>00545     }
<a name="l00546"></a>00546 
<a name="l00547"></a>00547     
<a name="l00555"></a><a class="code" href="classPEIP__XML__Context.html#67659c378217309ceaa0a53b83bd19cc">00555</a>     <span class="keyword">public</span> function buildAndModify($config, $arguments, $defaultClass = <span class="keyword">false</span>){
<a name="l00556"></a>00556         $service = $this-&gt;modifyService(self::doBuild($config, $arguments, $defaultClass), $config);
<a name="l00557"></a>00557         $id = trim((string)$config['<span class="keywordtype">id</span>']);
<a name="l00558"></a>00558         <span class="keywordflow">if</span>($service &amp;&amp; $id != ''){
<a name="l00559"></a>00559             $this-&gt;services[$id] = $service;    
<a name="l00560"></a>00560         }
<a name="l00561"></a>00561         <span class="keywordflow">return</span> $service;
<a name="l00562"></a>00562     }
<a name="l00563"></a>00563     
<a name="l00564"></a><a class="code" href="classPEIP__XML__Context.html#802a50a57fee25d78620939f287c129b">00564</a>     <span class="keyword">protected</span> <span class="keyword">static</span> function doBuild($config, $arguments, $defaultClass = <span class="keyword">false</span>){
<a name="l00565"></a>00565         $cls = $config[<span class="stringliteral">"class"</span>] ? trim((string)$config[<span class="stringliteral">"class"</span>]) : (string)$defaultClass;
<a name="l00566"></a>00566         <span class="keywordflow">if</span>($cls != ''){
<a name="l00567"></a>00567             <span class="keywordflow">try</span> {
<a name="l00568"></a>00568                 <span class="keywordflow">return</span> self::build($cls, $arguments);       
<a name="l00569"></a>00569             }<span class="keywordflow">catch</span>(Exception $e){
<a name="l00570"></a>00570                 <span class="keywordflow">throw</span> <span class="keyword">new</span> RuntimeException('Could not create Service <span class="stringliteral">"'.$cls.'"</span> -&gt; '.$e-&gt;getMessage());
<a name="l00571"></a>00571             }           
<a name="l00572"></a>00572         }
<a name="l00573"></a>00573         <span class="keywordflow">throw</span> <span class="keyword">new</span> RuntimeException('Could not create Service <span class="stringliteral">"'.$cls.'"</span>. Class does not exist.');           
<a name="l00574"></a>00574     }   
<a name="l00575"></a>00575     
<a name="l00576"></a><a class="code" href="classPEIP__XML__Context.html#e11c78f41334ab8f4553fca14b708640">00576</a>     <span class="keyword">protected</span> <span class="keyword">static</span> function build($className, $arguments){
<a name="l00577"></a>00577         <span class="keywordflow">return</span> <a class="code" href="classPEIP__Generic__Builder.html#a8d7386b56adf7d938c2ce6c98cba0a0">PEIP_Generic_Builder::getInstance</a>($className)-&gt;build($arguments);
<a name="l00578"></a>00578     }
<a name="l00579"></a>00579 
<a name="l00580"></a>00580 
<a name="l00581"></a>00581 } 
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Mon Apr 12 11:39:00 2010 for PEIP by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.1 </small></address>
</body>
</html>
